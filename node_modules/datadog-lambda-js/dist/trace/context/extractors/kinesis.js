"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.KinesisEventTraceExtractor = void 0;
var utils_1 = require("../../../utils");
var KinesisEventTraceExtractor = /** @class */ (function () {
    function KinesisEventTraceExtractor(tracerWrapper) {
        this.tracerWrapper = tracerWrapper;
    }
    KinesisEventTraceExtractor.prototype.extract = function (event) {
        var _a, _b;
        var kinesisData = (_b = (_a = event === null || event === void 0 ? void 0 : event.Records) === null || _a === void 0 ? void 0 : _a[0]) === null || _b === void 0 ? void 0 : _b.kinesis.data;
        if (kinesisData === undefined)
            return null;
        try {
            var decodedData = Buffer.from(kinesisData, "base64").toString("ascii");
            var parsedBody = JSON.parse(decodedData);
            var headers = parsedBody === null || parsedBody === void 0 ? void 0 : parsedBody._datadog;
            if (headers) {
                var traceContext = this.tracerWrapper.extract(headers);
                if (traceContext === null)
                    return null;
                (0, utils_1.logDebug)("Extracted trace context from Kinesis event", { traceContext: traceContext, headers: headers });
                return traceContext;
            }
        }
        catch (error) {
            if (error instanceof Error) {
                (0, utils_1.logDebug)("Unable to extract trace context from Kinesis event", error);
            }
        }
        return null;
    };
    return KinesisEventTraceExtractor;
}());
exports.KinesisEventTraceExtractor = KinesisEventTraceExtractor;
//# sourceMappingURL=kinesis.js.map